
create table person
(
    id            integer generated by default as identity
        primary key,
    name          varchar                               not null,
    date_of_birth date                                  not null,
    add_time      timestamp                             not null,
    gender        varchar default ''::character varying not null,
    phone_number  varchar(9)
        unique
        constraint person_phone_number_check
            check (length((phone_number)::text) = 9)
);

create table place
(
    id             integer generated by default as identity
        primary key,
    name_of_place  varchar not null,
    description    varchar,
    longitude      numeric(9, 6),
    latitude       numeric(9, 6),
    count_of_votes integer          default 0,
    rating         double precision default 0
        constraint place_rating_check
            check (rating <= (5)::double precision)
    );

create table photos
(
    place_id  integer
        references place,
    photo_url varchar not null,
    id        integer generated by default as identity
        primary key
);

create table timetable
(
    id          integer generated by default as identity
        primary key,
    place_id    integer
        references place,
    day_of_week varchar(20),
    start_time  time,
    end_time    time
);

create table type
(
    id   integer generated by default as identity
        primary key,
    name varchar(100)
);

CREATE table place_type(
                          id int generated by default as identity primary key,
                          place_id int REFERENCES place(id),
                          type_id int references type(id)
);

INSERT INTO Type (name)
VALUES ('entertainment'),
       ('new'),
       ('fishing'),
       ('family'),
       ('pair'),
       ('attractions'),
       ('activeVacation'),
       ('bigCompany'),
       ('other');

create table person_favourite_places
(
    person_id integer not null
        references person,
    place_id  integer not null
        references place,
    primary key (person_id, place_id)
);

create table person_recently_place
(
    person_id integer not null
        constraint person_recently_viewed_places_person_id_fkey
            references person,
    place_id  integer not null
        constraint person_recently_viewed_places_place_id_fkey
            references place,
    constraint person_recently_viewed_places_pkey
        primary key (person_id, place_id)
);

INSERT INTO person (name, date_of_birth, add_time, gender, phone_number) VALUES ('Петр', '09.01.2007', '2023-12-25 20:18:56.212776', 'unowned', '292867195');

create table verification
(
    phone_number      varchar(9) not null,
    verification_code varchar(6),
    id                integer generated by default as identity
        primary key,
    time_add          timestamp
);
